'use strict';Object.defineProperty(exports, "__esModule", { value: true });var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);var _assign = require('babel-runtime/core-js/object/assign');var _assign2 = _interopRequireDefault(_assign);var _regenerator = require('babel-runtime/regenerator');var _regenerator2 = _interopRequireDefault(_regenerator);var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);var _extends2 = require('babel-runtime/helpers/extends');var _extends3 = _interopRequireDefault(_extends2);var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);var _stringify = require('babel-runtime/core-js/json/stringify');var _stringify2 = _interopRequireDefault(_stringify);var _mapValues2 = require('lodash/fp/mapValues');var _mapValues3 = _interopRequireDefault(_mapValues2);var _toPairs2 = require('lodash/fp/toPairs');var _toPairs3 = _interopRequireDefault(_toPairs2);var _map3 = require('lodash/fp/map');var _map4 = _interopRequireDefault(_map3);var _join2 = require('lodash/fp/join');var _join3 = _interopRequireDefault(_join2);var _compose2 = require('lodash/fp/compose');var _compose3 = _interopRequireDefault(_compose2);var _isNil2 = require('lodash/fp/isNil');var _isNil3 = _interopRequireDefault(_isNil2);var _negate2 = require('lodash/fp/negate');var _negate3 = _interopRequireDefault(_negate2);var _pickBy2 = require('lodash/fp/pickBy');var _pickBy3 = _interopRequireDefault(_pickBy2);var _replace2 = require('lodash/replace');var _replace3 = _interopRequireDefault(_replace2);var _map5 = require('lodash/map');var _map6 = _interopRequireDefault(_map5);var _zipObject2 = require('lodash/zipObject');var _zipObject3 = _interopRequireDefault(_zipObject2);var _get2 = require('lodash/get');var _get3 = _interopRequireDefault(_get2);var _isPlainObject2 = require('lodash/isPlainObject');var _isPlainObject3 = _interopRequireDefault(_isPlainObject2);var _has2 = require('lodash/has');var _has3 = _interopRequireDefault(_has2);var _identity2 = require('lodash/identity');var _identity3 = _interopRequireDefault(_identity2);var _defaults2 = require('lodash/defaults');var _defaults3 = _interopRequireDefault(_defaults2);var _toUpper2 = require('lodash/toUpper');var _toUpper3 = _interopRequireDefault(_toUpper2);var _isNumber2 = require('lodash/isNumber');var _isNumber3 = _interopRequireDefault(_isNumber2);var _isString2 = require('lodash/isString');var _isString3 = _interopRequireDefault(_isString2);var _isObject2 = require('lodash/isObject');var _isObject3 = _interopRequireDefault(_isObject2);

















































































/**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Processes a "non-raw" response.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * This will consume the response with the desired response `format`.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Which is one of: text, json, buffer, blob etc. See node-fetch's
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Body class for more information. If using the browser AFAIK you're
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * limited to 'json' and 'text'.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {Object} response The http response from fetch.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {Object} options HTTP request options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @returns {Buffer|Object|string} The response in the desired format.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */var consumeResponse = function () {var _ref3 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(
  function _callee(response, _ref2) {var json = _ref2.json,_ref2$format = _ref2.format,format = _ref2$format === undefined ? 'text' : _ref2$format;var method, deserialize;return _regenerator2.default.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:
            method = json ? 'json' : format;
            deserialize = json ? JSON.parse : _identity3.default;if (!

            (0, _has3.default)(response, method)) {_context.next = 10;break;}_context.t1 =
            deserialize;_context.next = 6;return response[method]();case 6:_context.t2 = _context.sent;_context.t0 = (0, _context.t1)(_context.t2);_context.next = 15;break;case 10:_context.t3 =
            deserialize;_context.next = 13;return response.text();case 13:_context.t4 = _context.sent;_context.t0 = (0, _context.t3)(_context.t4);case 15:return _context.abrupt('return', _context.t0);case 16:case 'end':return _context.stop();}}}, _callee, this);}));return function consumeResponse(_x, _x2) {return _ref3.apply(this, arguments);};}();


/**
                                                                                                                                                                                                                                                                                                                                                                * The default response error handler, if none was supplied by the user.
                                                                                                                                                                                                                                                                                                                                                                * @param {Object} request The HTTP request object.
                                                                                                                                                                                                                                                                                                                                                                * @param {Object} response The HTTP response object.
                                                                                                                                                                                                                                                                                                                                                                */var _chainable = require('@jasonpollman/chainable');var _chainable2 = _interopRequireDefault(_chainable);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };} // In the browser, this will work with various bundlers like webpack
// using the native browser `fetch` implementation or a polyfill, but
// you'll need to ignore the `node-fetch` library.
// eslint-disable-next-line global-require
var fetch = typeof window !== 'undefined' ? window.fetch : require('node-fetch'); /**
                                                                                   * Stringifies objects only, leaves other values untouched.
                                                                                   * @param {Object|string} value The value to maybe stringify.
                                                                                   * @returns {string} The original string input value, or the stringified value.
                                                                                   */ /**
                                                                                       * A chainable fetch library.
                                                                                       * @since 5/9/18
                                                                                       * @file
                                                                                       */var maybeStringify = function maybeStringify(value) {return (0, _isObject3.default)(value) ? (0, _stringify2.default)(value) : value;}; /**
                                                                                                                                                                                                                                  * Used to omit non-string, non-numeric, and non-object values from querystrings.
                                                                                                                                                                                                                                  * @param {any} value The value to inspect.
                                                                                                                                                                                                                                  * @returns {boolean} True if the value is a valid querystring value, false otherwise.
                                                                                                                                                                                                                                  */var isOfQueryStringType = function isOfQueryStringType(value) {return (0, _isString3.default)(value) || (0, _isNumber3.default)(value) || (0, _isObject3.default)(value);}; /**
                                                                                                                                                                                                                                                                                                                                                                                                                 * Removes nil values from objects.
                                                                                                                                                                                                                                                                                                                                                                                                                 * @function
                                                                                                                                                                                                                                                                                                                                                                                                                 */var withoutNilValues = (0, _pickBy3.default)((0, _negate3.default)(_isNil3.default)); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * Converts an object to a querystring.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * This differs from querystring.stringify in that it JSON.stringify's object values.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          * @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          */var querystringify = (0, _compose3.default)((0, _join3.default)('&'), (0, _map4.default)((0, _join3.default)('=')), _toPairs3.default, (0, _mapValues3.default)(encodeURIComponent), (0, _mapValues3.default)(maybeStringify), (0, _pickBy3.default)(isOfQueryStringType)); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * The base headers applied to all requests if the `json` option is enabled.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         * @type {Object<string>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         */var JSONHeaders = { Accept: 'application/json', 'Content-Type': 'application/json' }; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * Formats the HTTP request options by adding the query string to the base url,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * uppercasing the method, etc. You can pass additional options that [node-]fetch supports here
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * (such as 'follow', 'timeout', etc.).
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @param {Object} options HTTP request options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @returns {Object} The formatted request options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */var formatRequestOptions = function formatRequestOptions(_ref) {var url = _ref.url,body = _ref.body,json = _ref.json,query = _ref.query,method = _ref.method,headers = _ref.headers,rest = (0, _objectWithoutProperties3.default)(_ref, ['url', 'body', 'json', 'query', 'method', 'headers']);return withoutNilValues((0, _extends3.default)({ method: (0, _toUpper3.default)(method), href: '' + url + (query ? '?' + querystringify(query) : ''), body: json ? (0, _stringify2.default)(body) : body, headers: json ? (0, _defaults3.default)({}, headers, JSONHeaders) : headers }, rest));};function handleResponseErrors(request, response, _ref4) {var url = _ref4.url;var status = response.status,statusText = response.statusText;throw (0, _assign2.default)(new Error('Request to ' + url + ' failed: ' + status + ' - ' + statusText), { request: request, response: response });} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * Creates a function that makes an HTTP request using fetch and the provided method.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @param {string} method The HTTP method this http request method is for.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     * @returns {function} A http request function.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     */function initiateHttpRequest(method) {return function () {var _ref5 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2() {var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};var options, interceptor, _interceptor, href, fetchOptions, response, responseInterceptor, handleResponseError;return _regenerator2.default.wrap(function _callee2$(_context2) {while (1) {switch (_context2.prev = _context2.next) {case 0:if ((0, _isPlainObject3.default)(opts)) {_context2.next = 2;break;}throw new TypeError('Request options must be a plain object.');case 2:options = (0, _defaults3.default)({ url: this.toString(), method: method }, opts, this.requestOptions, { json: true }); // Pipe the options to the request interceptor, its return value will
              // be used in lieu of the given options. Here you can force headers, etc.
              interceptor = (0, _get3.default)(options, 'interceptors.request', _identity3.default);_interceptor = interceptor(formatRequestOptions(options)), href = _interceptor.href, fetchOptions = (0, _objectWithoutProperties3.default)(_interceptor, ['href']);_context2.next = 7;return fetch(href, fetchOptions);case 7:response = _context2.sent;if (!options.raw) {_context2.next = 10;break;}return _context2.abrupt('return', response);case 10:responseInterceptor = (0, _get3.default)(options, 'interceptors.response', _identity3.default);handleResponseError = (0, _get3.default)(options, 'handleResponseError', handleResponseErrors); // If the response is "ok" consume it and pipe it to the response interceptor.
              // If not, invoke the user's `handleResponseError` method.
              return _context2.abrupt('return', response.ok ? responseInterceptor(consumeResponse(response, options), options) : handleResponseError(request, response, options));case 13:case 'end':return _context2.stop();}}}, _callee2, this);}));function request() {return _ref5.apply(this, arguments);}return request;}();
}

/**
   * Creates a "base" chainable object for use with chainable-fetch.
   * @type {Object}
   */
var chainableFetch = function () {
  var methods = [
  'get',
  'put',
  'post',
  'delete',
  'option'];


  return (0, _chainable.chainableGeneratorWithDefaults)(
  (0, _assign2.default)((0, _zipObject3.default)(methods, (0, _map6.default)(methods, initiateHttpRequest)), {
    separator: '/',
    sanitizeLinks: encodeURIComponent,

    /**
                                        * A mechanism so users can use keywords like
                                        * `get` and `post` as path endpoints.
                                        * @param {string} endpoint The endpoint to push.
                                        * @returns {Proxy} The chainable child object.
                                        */
    path: function path(endpoint) {
      if (!(0, _isString3.default)(endpoint) && !(0, _isNumber3.default)(endpoint)) {
        throw new TypeError('Endpoint must be a string or numeric value');
      }

      return (0, _chainable2.default)((0, _extends3.default)({},
      this, {
        tokens: [].concat((0, _toConsumableArray3.default)(this.tokens), [endpoint]) }));

    } }));


}();

/**
      * Creates a new chainable fetch api that will make requests to "options.host".
      * The given options will be merged with the defaults from above and a chainable
      * proxy object will be returned.
      * @function
      */exports.default =
function (options) {
  var requestOptions = (0, _isPlainObject3.default)(options) ? (0, _extends3.default)({}, options) : { host: options };

  // Not using url.parse for browser support.
  /** @todo This could be a bit more comprehensive. */var _ref6 =
  (0, _get3.default)(requestOptions, 'host', '').match(/(https?):\/\/(.*)/) || [],_ref7 = (0, _slicedToArray3.default)(_ref6, 3),protocol = _ref7[1],hostname = _ref7[2];

  if (!protocol || !hostname) {
    throw new TypeError('Host must be a valid url with a protocol and hostname.');
  }

  return chainableFetch({
    prefix: (0, _replace3.default)(requestOptions.host, /\/$/, ''),
    requestOptions: requestOptions });

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jaGFpbmFibGUtZmV0Y2guanMiXSwibmFtZXMiOlsicmVzcG9uc2UiLCJqc29uIiwiZm9ybWF0IiwibWV0aG9kIiwiZGVzZXJpYWxpemUiLCJKU09OIiwicGFyc2UiLCJ0ZXh0IiwiY29uc3VtZVJlc3BvbnNlIiwiZmV0Y2giLCJ3aW5kb3ciLCJyZXF1aXJlIiwibWF5YmVTdHJpbmdpZnkiLCJ2YWx1ZSIsImlzT2ZRdWVyeVN0cmluZ1R5cGUiLCJ3aXRob3V0TmlsVmFsdWVzIiwicXVlcnlzdHJpbmdpZnkiLCJlbmNvZGVVUklDb21wb25lbnQiLCJKU09OSGVhZGVycyIsIkFjY2VwdCIsImZvcm1hdFJlcXVlc3RPcHRpb25zIiwidXJsIiwiYm9keSIsInF1ZXJ5IiwiaGVhZGVycyIsInJlc3QiLCJocmVmIiwiaGFuZGxlUmVzcG9uc2VFcnJvcnMiLCJyZXF1ZXN0Iiwic3RhdHVzIiwic3RhdHVzVGV4dCIsIkVycm9yIiwiaW5pdGlhdGVIdHRwUmVxdWVzdCIsIm9wdHMiLCJUeXBlRXJyb3IiLCJvcHRpb25zIiwidG9TdHJpbmciLCJyZXF1ZXN0T3B0aW9ucyIsImludGVyY2VwdG9yIiwiZmV0Y2hPcHRpb25zIiwicmF3IiwicmVzcG9uc2VJbnRlcmNlcHRvciIsImhhbmRsZVJlc3BvbnNlRXJyb3IiLCJvayIsImNoYWluYWJsZUZldGNoIiwibWV0aG9kcyIsInNlcGFyYXRvciIsInNhbml0aXplTGlua3MiLCJwYXRoIiwiZW5kcG9pbnQiLCJ0b2tlbnMiLCJob3N0IiwibWF0Y2giLCJwcm90b2NvbCIsImhvc3RuYW1lIiwicHJlZml4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0ZBOzs7Ozs7Ozs7O0FBVUEsbUJBQStCQSxRQUEvQixjQUEyQ0MsSUFBM0MsU0FBMkNBLElBQTNDLHNCQUFpREMsTUFBakQsQ0FB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QXdCO0FBQzVCLFVBQUksQ0FBQyx3QkFBV0EsUUFBWCxDQUFELElBQXlCLENBQUMsd0JBQVdBLFFBQVgsQ0FBOUIsRUFBb0Q7QUFDbEQsY0FBTSxJQUFJZixTQUFKLENBQWMsNENBQWQsQ0FBTjtBQUNEOztBQUVELGFBQU87QUFDRixVQURFO0FBRUxnQiwyREFBWSxLQUFLQSxNQUFqQixJQUF5QkQsUUFBekIsRUFGSyxJQUFQOztBQUlELEtBbkJzRSxFQUF6RSxDQURLLENBQVA7OztBQXVCRCxDQWhDc0IsRUFBdkI7O0FBa0NBOzs7Ozs7QUFNZSxVQUFDZCxPQUFELEVBQWE7QUFDMUIsTUFBTUUsaUJBQWlCLDZCQUFnQkYsT0FBaEIsK0JBQWdDQSxPQUFoQyxJQUE0QyxFQUFFZ0IsTUFBTWhCLE9BQVIsRUFBbkU7O0FBRUE7QUFDQSxzREFKMEI7QUFLSyxxQkFBTUUsY0FBTixFQUFzQixNQUF0QixFQUE4QixFQUE5QixFQUFrQ2UsS0FBbEMsQ0FBd0MsbUJBQXhDLEtBQWdFLEVBTHJFLGdEQUtqQkMsUUFMaUIsWUFLUEMsUUFMTzs7QUFPMUIsTUFBSSxDQUFDRCxRQUFELElBQWEsQ0FBQ0MsUUFBbEIsRUFBNEI7QUFDMUIsVUFBTSxJQUFJcEIsU0FBSixDQUFjLHdEQUFkLENBQU47QUFDRDs7QUFFRCxTQUFPVSxlQUFlO0FBQ3BCVyxZQUFRLHVCQUFVbEIsZUFBZWMsSUFBekIsRUFBK0IsS0FBL0IsRUFBc0MsRUFBdEMsQ0FEWTtBQUVwQmQsa0NBRm9CLEVBQWYsQ0FBUDs7QUFJRCxDIiwiZmlsZSI6ImNoYWluYWJsZS1mZXRjaC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQSBjaGFpbmFibGUgZmV0Y2ggbGlicmFyeS5cbiAqIEBzaW5jZSA1LzkvMThcbiAqIEBmaWxlXG4gKi9cblxuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBmcCBmcm9tICdsb2Rhc2gvZnAnO1xuaW1wb3J0IGNoYWluYWJsZSwgeyBjaGFpbmFibGVHZW5lcmF0b3JXaXRoRGVmYXVsdHMgfSBmcm9tICdAamFzb25wb2xsbWFuL2NoYWluYWJsZSc7XG5cbi8vIEluIHRoZSBicm93c2VyLCB0aGlzIHdpbGwgd29yayB3aXRoIHZhcmlvdXMgYnVuZGxlcnMgbGlrZSB3ZWJwYWNrXG4vLyB1c2luZyB0aGUgbmF0aXZlIGJyb3dzZXIgYGZldGNoYCBpbXBsZW1lbnRhdGlvbiBvciBhIHBvbHlmaWxsLCBidXRcbi8vIHlvdSdsbCBuZWVkIHRvIGlnbm9yZSB0aGUgYG5vZGUtZmV0Y2hgIGxpYnJhcnkuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgZ2xvYmFsLXJlcXVpcmVcbmNvbnN0IGZldGNoID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cuZmV0Y2ggOiByZXF1aXJlKCdub2RlLWZldGNoJyk7XG5cbi8qKlxuICogU3RyaW5naWZpZXMgb2JqZWN0cyBvbmx5LCBsZWF2ZXMgb3RoZXIgdmFsdWVzIHVudG91Y2hlZC5cbiAqIEBwYXJhbSB7T2JqZWN0fHN0cmluZ30gdmFsdWUgVGhlIHZhbHVlIHRvIG1heWJlIHN0cmluZ2lmeS5cbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBvcmlnaW5hbCBzdHJpbmcgaW5wdXQgdmFsdWUsIG9yIHRoZSBzdHJpbmdpZmllZCB2YWx1ZS5cbiAqL1xuY29uc3QgbWF5YmVTdHJpbmdpZnkgPSB2YWx1ZSA9PiAoXy5pc09iamVjdCh2YWx1ZSkgPyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgOiB2YWx1ZSk7XG5cbi8qKlxuICogVXNlZCB0byBvbWl0IG5vbi1zdHJpbmcsIG5vbi1udW1lcmljLCBhbmQgbm9uLW9iamVjdCB2YWx1ZXMgZnJvbSBxdWVyeXN0cmluZ3MuXG4gKiBAcGFyYW0ge2FueX0gdmFsdWUgVGhlIHZhbHVlIHRvIGluc3BlY3QuXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgdmFsdWUgaXMgYSB2YWxpZCBxdWVyeXN0cmluZyB2YWx1ZSwgZmFsc2Ugb3RoZXJ3aXNlLlxuICovXG5jb25zdCBpc09mUXVlcnlTdHJpbmdUeXBlID0gdmFsdWUgPT4gXy5pc1N0cmluZyh2YWx1ZSkgfHwgXy5pc051bWJlcih2YWx1ZSkgfHwgXy5pc09iamVjdCh2YWx1ZSk7XG5cbi8qKlxuICogUmVtb3ZlcyBuaWwgdmFsdWVzIGZyb20gb2JqZWN0cy5cbiAqIEBmdW5jdGlvblxuICovXG5jb25zdCB3aXRob3V0TmlsVmFsdWVzID0gZnAucGlja0J5KGZwLm5lZ2F0ZShmcC5pc05pbCkpO1xuXG4vKipcbiAqIENvbnZlcnRzIGFuIG9iamVjdCB0byBhIHF1ZXJ5c3RyaW5nLlxuICogVGhpcyBkaWZmZXJzIGZyb20gcXVlcnlzdHJpbmcuc3RyaW5naWZ5IGluIHRoYXQgaXQgSlNPTi5zdHJpbmdpZnkncyBvYmplY3QgdmFsdWVzLlxuICogQGZ1bmN0aW9uXG4gKi9cbmNvbnN0IHF1ZXJ5c3RyaW5naWZ5ID0gZnAuY29tcG9zZShcbiAgZnAuam9pbignJicpLFxuICBmcC5tYXAoZnAuam9pbignPScpKSxcbiAgZnAudG9QYWlycyxcbiAgZnAubWFwVmFsdWVzKGVuY29kZVVSSUNvbXBvbmVudCksXG4gIGZwLm1hcFZhbHVlcyhtYXliZVN0cmluZ2lmeSksXG4gIGZwLnBpY2tCeShpc09mUXVlcnlTdHJpbmdUeXBlKSxcbik7XG5cbi8qKlxuICogVGhlIGJhc2UgaGVhZGVycyBhcHBsaWVkIHRvIGFsbCByZXF1ZXN0cyBpZiB0aGUgYGpzb25gIG9wdGlvbiBpcyBlbmFibGVkLlxuICogQHR5cGUge09iamVjdDxzdHJpbmc+fVxuICovXG5jb25zdCBKU09OSGVhZGVycyA9IHtcbiAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXG4gICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG59O1xuXG4vKipcbiAqIEZvcm1hdHMgdGhlIEhUVFAgcmVxdWVzdCBvcHRpb25zIGJ5IGFkZGluZyB0aGUgcXVlcnkgc3RyaW5nIHRvIHRoZSBiYXNlIHVybCxcbiAqIHVwcGVyY2FzaW5nIHRoZSBtZXRob2QsIGV0Yy4gWW91IGNhbiBwYXNzIGFkZGl0aW9uYWwgb3B0aW9ucyB0aGF0IFtub2RlLV1mZXRjaCBzdXBwb3J0cyBoZXJlXG4gKiAoc3VjaCBhcyAnZm9sbG93JywgJ3RpbWVvdXQnLCBldGMuKS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIEhUVFAgcmVxdWVzdCBvcHRpb25zLlxuICogQHJldHVybnMge09iamVjdH0gVGhlIGZvcm1hdHRlZCByZXF1ZXN0IG9wdGlvbnMuXG4gKi9cbmNvbnN0IGZvcm1hdFJlcXVlc3RPcHRpb25zID0gKHtcbiAgdXJsLFxuICBib2R5LFxuICBqc29uLFxuICBxdWVyeSxcbiAgbWV0aG9kLFxuICBoZWFkZXJzLFxuICAuLi5yZXN0XG59KSA9PiB3aXRob3V0TmlsVmFsdWVzKHtcbiAgbWV0aG9kOiBfLnRvVXBwZXIobWV0aG9kKSxcbiAgaHJlZjogYCR7dXJsfSR7cXVlcnkgPyBgPyR7cXVlcnlzdHJpbmdpZnkocXVlcnkpfWAgOiAnJ31gLFxuICBib2R5OiBqc29uID8gSlNPTi5zdHJpbmdpZnkoYm9keSkgOiBib2R5LFxuICBoZWFkZXJzOiBqc29uID8gXy5kZWZhdWx0cyh7fSwgaGVhZGVycywgSlNPTkhlYWRlcnMpIDogaGVhZGVycyxcbiAgLi4ucmVzdCxcbn0pO1xuXG4vKipcbiAqIFByb2Nlc3NlcyBhIFwibm9uLXJhd1wiIHJlc3BvbnNlLlxuICogVGhpcyB3aWxsIGNvbnN1bWUgdGhlIHJlc3BvbnNlIHdpdGggdGhlIGRlc2lyZWQgcmVzcG9uc2UgYGZvcm1hdGAuXG4gKiBXaGljaCBpcyBvbmUgb2Y6IHRleHQsIGpzb24sIGJ1ZmZlciwgYmxvYiBldGMuIFNlZSBub2RlLWZldGNoJ3NcbiAqIEJvZHkgY2xhc3MgZm9yIG1vcmUgaW5mb3JtYXRpb24uIElmIHVzaW5nIHRoZSBicm93c2VyIEFGQUlLIHlvdSdyZVxuICogbGltaXRlZCB0byAnanNvbicgYW5kICd0ZXh0Jy5cbiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSBUaGUgaHR0cCByZXNwb25zZSBmcm9tIGZldGNoLlxuICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgSFRUUCByZXF1ZXN0IG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7QnVmZmVyfE9iamVjdHxzdHJpbmd9IFRoZSByZXNwb25zZSBpbiB0aGUgZGVzaXJlZCBmb3JtYXQuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNvbnN1bWVSZXNwb25zZShyZXNwb25zZSwgeyBqc29uLCBmb3JtYXQgPSAndGV4dCcgfSkge1xuICBjb25zdCBtZXRob2QgPSBqc29uID8gJ2pzb24nIDogZm9ybWF0O1xuICBjb25zdCBkZXNlcmlhbGl6ZSA9IGpzb24gPyBKU09OLnBhcnNlIDogXy5pZGVudGl0eTtcblxuICByZXR1cm4gXy5oYXMocmVzcG9uc2UsIG1ldGhvZClcbiAgICA/IGRlc2VyaWFsaXplKGF3YWl0IHJlc3BvbnNlW21ldGhvZF0oKSlcbiAgICA6IGRlc2VyaWFsaXplKGF3YWl0IHJlc3BvbnNlLnRleHQoKSk7XG59XG5cbi8qKlxuICogVGhlIGRlZmF1bHQgcmVzcG9uc2UgZXJyb3IgaGFuZGxlciwgaWYgbm9uZSB3YXMgc3VwcGxpZWQgYnkgdGhlIHVzZXIuXG4gKiBAcGFyYW0ge09iamVjdH0gcmVxdWVzdCBUaGUgSFRUUCByZXF1ZXN0IG9iamVjdC5cbiAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSBUaGUgSFRUUCByZXNwb25zZSBvYmplY3QuXG4gKi9cbmZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlRXJyb3JzKHJlcXVlc3QsIHJlc3BvbnNlLCB7IHVybCB9KSB7XG4gIGNvbnN0IHsgc3RhdHVzLCBzdGF0dXNUZXh0IH0gPSByZXNwb25zZTtcbiAgdGhyb3cgT2JqZWN0LmFzc2lnbihuZXcgRXJyb3IoYFJlcXVlc3QgdG8gJHt1cmx9IGZhaWxlZDogJHtzdGF0dXN9IC0gJHtzdGF0dXNUZXh0fWApLCB7XG4gICAgcmVxdWVzdCxcbiAgICByZXNwb25zZSxcbiAgfSk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRoYXQgbWFrZXMgYW4gSFRUUCByZXF1ZXN0IHVzaW5nIGZldGNoIGFuZCB0aGUgcHJvdmlkZWQgbWV0aG9kLlxuICogQHBhcmFtIHtzdHJpbmd9IG1ldGhvZCBUaGUgSFRUUCBtZXRob2QgdGhpcyBodHRwIHJlcXVlc3QgbWV0aG9kIGlzIGZvci5cbiAqIEByZXR1cm5zIHtmdW5jdGlvbn0gQSBodHRwIHJlcXVlc3QgZnVuY3Rpb24uXG4gKi9cbmZ1bmN0aW9uIGluaXRpYXRlSHR0cFJlcXVlc3QobWV0aG9kKSB7XG4gIHJldHVybiBhc3luYyBmdW5jdGlvbiByZXF1ZXN0KG9wdHMgPSB7fSkge1xuICAgIGlmICghXy5pc1BsYWluT2JqZWN0KG9wdHMpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdSZXF1ZXN0IG9wdGlvbnMgbXVzdCBiZSBhIHBsYWluIG9iamVjdC4nKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcHRpb25zID0gXy5kZWZhdWx0cyh7IHVybDogdGhpcy50b1N0cmluZygpLCBtZXRob2QgfSwgb3B0cywgdGhpcy5yZXF1ZXN0T3B0aW9ucywge1xuICAgICAganNvbjogdHJ1ZSxcbiAgICB9KTtcblxuICAgIC8vIFBpcGUgdGhlIG9wdGlvbnMgdG8gdGhlIHJlcXVlc3QgaW50ZXJjZXB0b3IsIGl0cyByZXR1cm4gdmFsdWUgd2lsbFxuICAgIC8vIGJlIHVzZWQgaW4gbGlldSBvZiB0aGUgZ2l2ZW4gb3B0aW9ucy4gSGVyZSB5b3UgY2FuIGZvcmNlIGhlYWRlcnMsIGV0Yy5cbiAgICBjb25zdCBpbnRlcmNlcHRvciA9IF8uZ2V0KG9wdGlvbnMsICdpbnRlcmNlcHRvcnMucmVxdWVzdCcsIF8uaWRlbnRpdHkpO1xuICAgIGNvbnN0IHsgaHJlZiwgLi4uZmV0Y2hPcHRpb25zIH0gPSBpbnRlcmNlcHRvcihmb3JtYXRSZXF1ZXN0T3B0aW9ucyhvcHRpb25zKSk7XG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGhyZWYsIGZldGNoT3B0aW9ucyk7XG4gICAgaWYgKG9wdGlvbnMucmF3KSByZXR1cm4gcmVzcG9uc2U7XG5cbiAgICBjb25zdCByZXNwb25zZUludGVyY2VwdG9yID0gXy5nZXQob3B0aW9ucywgJ2ludGVyY2VwdG9ycy5yZXNwb25zZScsIF8uaWRlbnRpdHkpO1xuICAgIGNvbnN0IGhhbmRsZVJlc3BvbnNlRXJyb3IgPSBfLmdldChvcHRpb25zLCAnaGFuZGxlUmVzcG9uc2VFcnJvcicsIGhhbmRsZVJlc3BvbnNlRXJyb3JzKTtcblxuICAgIC8vIElmIHRoZSByZXNwb25zZSBpcyBcIm9rXCIgY29uc3VtZSBpdCBhbmQgcGlwZSBpdCB0byB0aGUgcmVzcG9uc2UgaW50ZXJjZXB0b3IuXG4gICAgLy8gSWYgbm90LCBpbnZva2UgdGhlIHVzZXIncyBgaGFuZGxlUmVzcG9uc2VFcnJvcmAgbWV0aG9kLlxuICAgIHJldHVybiByZXNwb25zZS5va1xuICAgICAgPyByZXNwb25zZUludGVyY2VwdG9yKGNvbnN1bWVSZXNwb25zZShyZXNwb25zZSwgb3B0aW9ucyksIG9wdGlvbnMpXG4gICAgICA6IGhhbmRsZVJlc3BvbnNlRXJyb3IocmVxdWVzdCwgcmVzcG9uc2UsIG9wdGlvbnMpO1xuICB9O1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBcImJhc2VcIiBjaGFpbmFibGUgb2JqZWN0IGZvciB1c2Ugd2l0aCBjaGFpbmFibGUtZmV0Y2guXG4gKiBAdHlwZSB7T2JqZWN0fVxuICovXG5jb25zdCBjaGFpbmFibGVGZXRjaCA9ICgoKSA9PiB7XG4gIGNvbnN0IG1ldGhvZHMgPSBbXG4gICAgJ2dldCcsXG4gICAgJ3B1dCcsXG4gICAgJ3Bvc3QnLFxuICAgICdkZWxldGUnLFxuICAgICdvcHRpb24nLFxuICBdO1xuXG4gIHJldHVybiBjaGFpbmFibGVHZW5lcmF0b3JXaXRoRGVmYXVsdHMoXG4gICAgT2JqZWN0LmFzc2lnbihfLnppcE9iamVjdChtZXRob2RzLCBfLm1hcChtZXRob2RzLCBpbml0aWF0ZUh0dHBSZXF1ZXN0KSksIHtcbiAgICAgIHNlcGFyYXRvcjogJy8nLFxuICAgICAgc2FuaXRpemVMaW5rczogZW5jb2RlVVJJQ29tcG9uZW50LFxuXG4gICAgICAvKipcbiAgICAgICAqIEEgbWVjaGFuaXNtIHNvIHVzZXJzIGNhbiB1c2Uga2V5d29yZHMgbGlrZVxuICAgICAgICogYGdldGAgYW5kIGBwb3N0YCBhcyBwYXRoIGVuZHBvaW50cy5cbiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBlbmRwb2ludCBUaGUgZW5kcG9pbnQgdG8gcHVzaC5cbiAgICAgICAqIEByZXR1cm5zIHtQcm94eX0gVGhlIGNoYWluYWJsZSBjaGlsZCBvYmplY3QuXG4gICAgICAgKi9cbiAgICAgIHBhdGg6IGZ1bmN0aW9uIHBhdGgoZW5kcG9pbnQpIHtcbiAgICAgICAgaWYgKCFfLmlzU3RyaW5nKGVuZHBvaW50KSAmJiAhXy5pc051bWJlcihlbmRwb2ludCkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFbmRwb2ludCBtdXN0IGJlIGEgc3RyaW5nIG9yIG51bWVyaWMgdmFsdWUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjaGFpbmFibGUoe1xuICAgICAgICAgIC4uLnRoaXMsXG4gICAgICAgICAgdG9rZW5zOiBbLi4udGhpcy50b2tlbnMsIGVuZHBvaW50XSxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0pLFxuICApO1xufSkoKTtcblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGNoYWluYWJsZSBmZXRjaCBhcGkgdGhhdCB3aWxsIG1ha2UgcmVxdWVzdHMgdG8gXCJvcHRpb25zLmhvc3RcIi5cbiAqIFRoZSBnaXZlbiBvcHRpb25zIHdpbGwgYmUgbWVyZ2VkIHdpdGggdGhlIGRlZmF1bHRzIGZyb20gYWJvdmUgYW5kIGEgY2hhaW5hYmxlXG4gKiBwcm94eSBvYmplY3Qgd2lsbCBiZSByZXR1cm5lZC5cbiAqIEBmdW5jdGlvblxuICovXG5leHBvcnQgZGVmYXVsdCAob3B0aW9ucykgPT4ge1xuICBjb25zdCByZXF1ZXN0T3B0aW9ucyA9IF8uaXNQbGFpbk9iamVjdChvcHRpb25zKSA/IHsgLi4ub3B0aW9ucyB9IDogeyBob3N0OiBvcHRpb25zIH07XG5cbiAgLy8gTm90IHVzaW5nIHVybC5wYXJzZSBmb3IgYnJvd3NlciBzdXBwb3J0LlxuICAvKiogQHRvZG8gVGhpcyBjb3VsZCBiZSBhIGJpdCBtb3JlIGNvbXByZWhlbnNpdmUuICovXG4gIGNvbnN0IFssIHByb3RvY29sLCBob3N0bmFtZV0gPSBfLmdldChyZXF1ZXN0T3B0aW9ucywgJ2hvc3QnLCAnJykubWF0Y2goLyhodHRwcz8pOlxcL1xcLyguKikvKSB8fCBbXTtcblxuICBpZiAoIXByb3RvY29sIHx8ICFob3N0bmFtZSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hvc3QgbXVzdCBiZSBhIHZhbGlkIHVybCB3aXRoIGEgcHJvdG9jb2wgYW5kIGhvc3RuYW1lLicpO1xuICB9XG5cbiAgcmV0dXJuIGNoYWluYWJsZUZldGNoKHtcbiAgICBwcmVmaXg6IF8ucmVwbGFjZShyZXF1ZXN0T3B0aW9ucy5ob3N0LCAvXFwvJC8sICcnKSxcbiAgICByZXF1ZXN0T3B0aW9ucyxcbiAgfSk7XG59O1xuIl19
